const products = [
  {
    id: 1,
    name: "Dish Rack",
    price: 80.0,
    originalPrice: 150.0,
    category: "appliance",
    image: "./images/products/dishrack.jpg",
    hoverImage: "./images/products/dishrack.jpg",
  },

  {
    id: 2,
    name: "Walkie Talkie",
    price: 45.0,
    originalPrice: 65.0,
    category: "electronic",
    image: "./images/products/walkie.jpg",
    hoverImage: "./images/products/walkie.jpg",
  },

  {
    id: 3,
    name: "Speaker",
    price: 88.0,
    originalPrice: 99.0,
    category: "electronic",
    image: "./images/products/speaker.jpg",
    hoverImage: "./images/products/speaker.jpg",
  },

  {
    id: 4,
    name: "Chanel HandBag",
    price: 70.0,
    originalPrice: 80.0,
    category: "bag",
    image: "./images/products/bag.jpg",
    hoverImage: "./images/products/bag.jpg",
  },

  {
    id: 5,
    name: "Gold Chain",
    price: 84.0,
    originalPrice: 90.0,
    category: "accessories",
    image: "./images/products/chain.jpg",
    hoverImage: "./images/products/chain.jpg",
  },

  {
    id: 6,
    name: "Face Cap",
    price: 20.0,
    originalPrice: 30.0,
    category: "hats",
    image: "./images/products/cap2.jpg",
    hoverImage: "./images/products/cap2.jpg",
  },

  {
    id: 7,
    name: "Kitchen Utensil",
    price: 95.0,
    originalPrice: 105.0,
    category: "appliance",
    image: "./images/products/dset.jpg",
    hoverImage: "./images/products/dset.jpg",
  },

  {
    id: 8,
    name: "Headset",
    price: 58.0,
    originalPrice: 65.0,
    category: "electronic",
    image: "./images/products/hset.jpg",
    hoverImage: "./images/products/hset.jpg",
  },

  {
    id: 9,
    name: "Makeup set",
    price: 100.0,
    originalPrice: 150.0,
    category: "cosmetic",
    image: "./images/products/mset.jpg",
    hoverImage: "./images/products/mset.jpg",
  },

  {
    id: 10,
    name: "Toaster",
    price: 52.0,
    originalPrice: 55.0,
    category: "appliance",
    image: "./images/products/toast.jpg",
    hoverImage: "./images/products/toast.jpg",
  },

  {
    id: 11,
    name: "Mascara",
    price: 15.0,
    originalPrice: 18.0,
    category: "cosmetic",
    image: "./images/products/eye.jpg ",
    hoverImage: "./images/products/eye.jpg",
  },

  {
    id: 12,
    name: "Gabbana Perfume",
    price: 84.0,
    originalPrice: 90.0,
    category: "perfume",
    image: "./images/products/pef.jpg",
    hoverImage: "./images/products/pef.jpg",
  },

  {
    id: 13,
    name: "Couples Ring",
    price: 56.0,
    originalPrice: 75.0,
    category: "accessories",
    image: "./images/products/ring.jpg",
    hoverImage: "./images/products/ring.jpg",
  },

  {
    id: 14,
    name: "Dove baby oil",
    price: 22.0,
    originalPrice: 25.0,
    category: "baby",
    image: "./images/products/oil.jpg",
    hoverImage: "./images/products/oil.jpg",
  },

  {
    id: 15,
    name: "Mix Blender",
    price: 90.0,
    originalPrice: 95.0,
    category: "appliance",
    image: "./images/products/blend.jpg",
    hoverImage: "./images/products/blend.jpg",
  },

  {
    id: 16,
    name: "White Polo",
    price: 62.0,
    originalPrice: 65.0,
    category: "shirts",
    image: "./images/products/polo.jpg",
    hoverImage: "./images/products/polo.jpg",
  },

  {
    id: 17,
    name: "Jean Shorts",
    price: 20.0,
    originalPrice: 30.0,
    category: "shorts",
    image: "./images/products/short.jpg",
    hoverImage: "./images/products/short.jpg",
  },

  {
    id: 18,
    name: "Spices Rack",
    price: 50.0,
    originalPrice: 70.0,
    category: "appliance",
    image: "./images/products/rack.jpg",
    hoverImage: "./images/products/rack.jpg",
  },

  {
    id: 19,
    name: "Mens Hood Jacket",
    price: 56.0,
    originalPrice: 75.0,
    category: "men",
    image: "./images/products/top.jpg",
    hoverImage: "./images/products/top.jpg",
  },

  {
    id: 20,
    name: "Dish set",
    price: 39.0,
    originalPrice: 59.0,
    category: "appliance",
    image: "./images/products/dish.jpg",
    hoverImage: "./images/products/dish.jpg",
  },
  {
    id: 21,
    name: "Cat Eye Lashes",
    price: 25.0,
    originalPrice: 30.0,
    category: "cosmetic",
    image: "./images/products/lash.jpg",
    hoverImage: "./images/products/lash.jpg",
  },
  {
    id: 22,
    name: "Cleaning Utensil",
    price: 100.0,
    originalPrice: 110.0,
    category: "appliance",
    image: "./images/products/clean.jpg",
    hoverImage: "./images/products/clean.jpg",
  },
  {
    id: 23,
    name: "Eye-opening lash",
    price: 25.0,
    originalPrice: 30.0,
    category: "cosmetic",
    image: "./images/products/lash2.jpg",
    hoverImage: "./images/products/lash2.jpg",
  },
  {
    id: 24,
    name: "Alexa alarm clock",
    price: 100.0,
    originalPrice: 110.0,
    category: "electronic",
    image: "./images/products/alexa.jpg",
    hoverImage: "./images/products/alexa.jpg",
  },
  {
    id: 25,
    name: "Hoodie",
    price: 28.0,
    originalPrice: 36.0,
    category: "shirts",
    image: "./images/products/2.jpg",
    hoverImage: "./images/products/2.jpg",
  },
  {
    id: 26,
    name: "Baggy Jeans",
    price: 30.0,
    originalPrice: 40.0,
    category: "jeans",
    image: "./images/products/jean.jpg",
    hoverImage: "./images/products/jean.jpg",
  },

  {
    id: 27,
    name: "White headphone",
    price: 97.0,
    originalPrice: 110.0,
    category: "electronic",
    image: "./images/products/headphone2.avif",
    hoverImage: "./images/products/headphone2.avif",
  },
  {
    id: 28,
    name: "Black BT headphone",
    price: 97.0,
    originalPrice: 110.0,
    category: "electronic",
    image: "./images/products/headphone3",
    hoverImage: "./images/products/headphone3",
  },
  {
    id: 29,
    name: "Black BT headphone",
    price: 90.0,
    originalPrice: 100.0,
    category: "electronic",
    image: "./images/products/headphone5.jpg",
    hoverImage: "./images/products/headphone5.jpg",
  },
  {
    id: 30,
    name: "Gaming headphone",
    price: 100.0,
    originalPrice: 120.0,
    category: "electronic",
    image: "./images/products/headphone6.avif",
    hoverImage: "./images/products/headphone6.avif",
  },
  {
    id: 31,
    name: "Spacious Backpack",
    price: 39.0,
    originalPrice: 49.0,
    category: "bag",
    image: "./images/products/bag2.jpg",
    hoverImage: "./images/products/bag2.jpg",
  },
  {
    id: 32,
    name: "Tablet Holder",
    price: 52.0,
    originalPrice: 55.0,
    category: "electronic",
    image: "./images/products/tab.jpg",
    hoverImage: "./images/products/tab.jpg",
  },
  {
    id: 33,
    name: "Black Plain Shirt",
    price: 25.0,
    originalPrice: 35.0,
    category: "shirts",
    image: "./images/products/black.jpg",
    hoverImage: "./images/products/black.jpg",
  },
  {
    id: 34,
    name: "Projector",
    price: 189.99,
    originalPrice: 199.0,
    category: "electronic",
    image: "./images/products/project.jpg",
    hoverImage: "./images/products/project.jpg",
  },
  {
    id: 35,
    name: "HoverBoard",
    price: 80.99,
    originalPrice: 90.0,
    category: "electronic",
    image: "./images/products/hoverboard.jpg",
    hoverImage: "./images/products/hoverboard.jpg",
  },
  {
    id: 36,
    name: "MP3",
    price: 80.0,
    originalPrice: 90.0,
    category: "electronic",
    image: "./images/products/mp.jpg",
    hoverImage: "./images/products/mp.jpg",
  },
  {
    id: 37,
    name: "Bow Black dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dblack.jpg",
    hoverImage: "./images/products/dblack.jpg",
  },
  {
    id: 38,
    name: "Bow Blue dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dblue.jpg",
    hoverImage: "./images/products/dblue.jpg",
  },
  {
    id: 39,
    name: "bubble Blue dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dfblue.jpg",
    hoverImage: "./images/products/dfblue.jpg",
  },
  {
    id: 40,
    name: "bubble Brown dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dfbrown.jpg",
    hoverImage: "./images/products/dfbrown.jpg",
  },
  {
    id: 41,
    name: "bubble pink dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dfpink.jpg",
    hoverImage: "./images/products/dfpink.jpg",
  },
  {
    id: 42,
    name: "offshoulder dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dnavy.jpg",
    hoverImage: "./images/products/dnavy.jpg",
  },
  {
    id: 43,
    name: "Bow pink dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dpink.jpg",
    hoverImage: "./images/products/dpink.jpg",
  },
  {
    id: 44,
    name: "offshoulder dress",
    price: 50.99,
    originalPrice: 60.99,
    category: "women",
    image: "./images/products/dred.jpg",
    hoverImage: "./images/products/dred.jpg",
  },
  {
    id: 45,
    name: "White earpods",
    price: 35.0,
    originalPrice: 55.0,
    category: "electronic",
    image: "./images/products/earpod1.jpg",
    hoverImage: "./images/products/earpod1.jpg",
  },
  {
    id: 46,
    name: "Black earpods",
    price: 35.0,
    originalPrice: 55.0,
    category: "electronic",
    image: "./images/products/earpod2.jpg",
    hoverImage: "./images/products/earpod2.jpg",
  },
  {
    id: 47,
    name: "Gray Plain Shirt",
    price: 25.0,
    originalPrice: 35.0,
    category: "shirts",
    image: "./images/products/gray.jpg",
    hoverImage: "./images/products/gray.jpg",
  },
  {
    id: 48,
    name: "Tablet",
    price: 100.0,
    originalPrice: 115.0,
    category: "electronic",
    image: "./images/products/tablet.jpg",
    hoverImage: "./images/products/tablet.jpg",
  },
  {
    id: 49,
    name: "Iphone 14",
    price: 90.0,
    originalPrice: 100.0,
    category: "electronic",
    image: "./images/products/phone 3.avif",
    hoverImage: "./images/products/phone 3.avif",
  },
  {
    id: 50,
    name: "Desktop Set",
    price: 300.0,
    originalPrice: 310.0,
    category: "electronic",
    image: "./images/products/desktop.jpg",
    hoverImage: "./images/products/desktop.jpg",
  },
  {
    id: 51,
    name: "Phone holder",
    price: 70.0,
    originalPrice: 80.0,
    category: "electronic",
    image: "./images/products/phone holder2.jpg",
    hoverImage: "./images/products/phone holder2.jpg",
  },
  {
    id: 52,
    name: "Phone holder",
    price: 70.0,
    originalPrice: 80.0,
    category: "electronic",
    image: "./images/products/phone-holder.jpg",
    hoverImage: "./images/products/phone-holder.jpg",
  },
  {
    id: 53,
    name: "Iphone",
    price: 200.0,
    originalPrice: 210.0,
    category: "electronic",
    image: "./images/products/phone-image.jpg",
    hoverImage: "./images/products/phone-image.jpg",
  },
  {
    id: 54,
    name: "Infinix Smart5",
    price: 200.0,
    originalPrice: 210.0,
    category: "electronic",
    image: "./images/products/phone2.avif",
    hoverImage: "./images/products/phone2.avif",
  },
  {
    id: 55,
    name: "Playstation",
    price: 150.0,
    originalPrice: 200.0,
    category: "electronic",
    image: "./images/products/playstation2.jpg",
    hoverImage: "./images/products/playstation2.jpg",
  },

  {
    id: 56,
    name: "washing machine",
    price: 150.0,
    originalPrice: 200.0,
    category: "appliance",
    image: "./images/products/wmachine.jpg",
    hoverImage: "./images/products/wmachine.jpg",
  },
  {
    id: 57,
    name: "Playstation",
    price: 150.0,
    originalPrice: 200.0,
    category: "electronic",
    image: "./images/products/playstation 4.avif",
    hoverImage: "./images/products/playstation 4.avif",
  },
  {
    id: 58,
    name: "Picture printer",
    price: 150.0,
    originalPrice: 200.0,
    category: "electronic",
    image: "./images/products/p-printer.jpg",
    hoverImage: "./images/products/p-printer.jpg",
  },
  {
    id: 59,
    name: "Playstation",
    price: 150.0,
    originalPrice: 200.0,
    category: "electronic",
    image: "./images/products/playstation 5.jpg",
    hoverImage: "./images/products/playstation 5.jpg",
  },
  {
    id: 60,
    name: "Powerbank",
    price: 100.0,
    originalPrice: 150.0,
    category: "electronic",
    image: "./images/products/power-bank.jpg",
    hoverImage: "./images/products/power-bank.jpg",
  },
  {
    id: 61,
    name: "Ball Gown",
    price: 99.99,
    originalPrice: 100.99,
    category: "women",
    image: "./images/products/promblue.jpg",
    hoverImage: "./images/products/promblue.jpg",
  },
  {
    id: 62,
    name: "Prom green dress",
    price: 99.99,
    originalPrice: 100.99,
    category: "women",
    image: "./images/products/promgreen.jpg",
    hoverImage: "./images/products/promgreen.jpg",
  },
  {
    id: 63,
    name: "Prom pink dress",
    price: 99.99,
    originalPrice: 100.99,
    category: "women",
    image: "./images/products/prompink.jpg",
    hoverImage: "./images/products/prompink.jpg",
  },
  {
    id: 64,
    name: "Prom purple dress",
    price: 99.99,
    originalPrice: 100.99,
    category: "women",
    image: "./images/products/prompurple.jpg",
    hoverImage: "./images/products/prompurple.jpg",
  },
  {
    id: 65,
    name: "Jean Skirt",
    price: 20.99,
    originalPrice: 30.99,
    category: "women",
    image: "./images/products/sblack.jpg",
    hoverImage: "./images/products/sblack.jpg",
  },
  {
    id: 66,
    name: "Hp Television",
    price: 250.0,
    originalPrice: 350.0,
    category: "electronic",
    image: "./images/products/tv 1.avif",
    hoverImage: "./images/products/tv 1.avif",
  },
  {
    id: 67,
    name: "Dell Television",
    price: 250.0,
    originalPrice: 350.0,
    category: "electronic",
    image: "./images/products/tv 2.avif",
    hoverImage: "./images/products/tv 2.avif",
  },
  {
    id: 68,
    name: "Television Stand",
    price: 150.0,
    originalPrice: 170.0,
    category: "appliance",
    image: "./images/products/tv-stand.jpg",
    hoverImage: "./images/products/tv-stand.jpg",
  },
  {
    id: 69,
    name: "Suit skirt",
    price: 89.99,
    originalPrice: 99.99,
    category: "women",
    image: "./images/products/updownblack.jpg",
    hoverImage: "./images/products/updownblack.jpg",
  },
  {
    id: 70,
    name: "Suit skirt",
    price: 89.99,
    originalPrice: 99.99,
    category: "women",
    image: "./images/products/updownblue.jpg",
    hoverImage: "./images/products/updownblue.jpg",
  },
  {
    id: 71,
    name: "Suit skirt",
    price: 89.99,
    originalPrice: 99.99,
    category: "women",
    image: "./images/products/updownpink.jpg",
    hoverImage: "./images/products/updownpink.jpg",
  },
  {
    id: 72,
    name: "Suit skirt",
    price: 89.99,
    originalPrice: 99.99,
    category: "women",
    image: "./images/products/updownwhite.jpg",
    hoverImage: "./images/products/updownwhite.jpg",
  },
  {
    id: 73,
    name: "Microphone",
    price: 25.0,
    originalPrice: 35.0,
    category: "electronic",
    image: "./images/products/mic.jpg",
    hoverImage: "./images/products/mic.jpg",
  },
  {
    id: 74,
    name: "White VR googles",
    price: 250.0,
    originalPrice: 350.0,
    category: "electronic",
    image: "./images/products/vr-image.jpg",
    hoverImage: "./images/products/vr-image.jpg",
  },
  {
    id: 75,
    name: "White plain shirt",
    price: 25.0,
    originalPrice: 35.0,
    category: "shirts",
    image: "./images/products/whiteshirt.jpg",
    hoverImage: "./images/products/whiteshirt.jpg",
  },
  {
    id: 76,
    name: "Coutoure Handbag",
    price: 70.0,
    originalPrice: 80.0,
    category: "bag",
    image: "./images/products/pbag.jpg",
    hoverImage: "./images/products/pbag.jpg",
  },
  {
    id: 77,
    name: "Stand Cooker",
    price: 170.0,
    originalPrice: 180.0,
    category: "appliance",
    image: "./images/products/scook.jpg",
    hoverImage: "./images/products/scook.jpg",
  },
  {
    id: 78,
    name: "Lash Curler",
    price: 20.0,
    originalPrice: 30.0,
    category: "cosmetic",
    image: "./images/products/lcurl.jpg",
    hoverImage: "./images/products/lcurl.jpg",
  },
  {
    id: 79,
    name: "Cross Bag",
    price: 45.0,
    originalPrice: 50.0,
    category: "bag",
    image: "./images/products/cbag.jpg",
    hoverImage: "./images/products/cbag.jpg",
  },

  {
    id: 80,
    name: "Ladies Bag",
    price: 45.0,
    originalPrice: 50.0,
    category: "bag",
    image: "./images/products/scbag.jpg",
    hoverImage: "./images/products/scbag.jpg",
  },

  {
    id: 81,
    name: "B&W Handbag",
    price: 45.0,
    originalPrice: 50.0,
    category: "bag",
    image: "./images/products/bwbag.jpg",
    hoverImage: "./images/products/bwbag.jpg",
  },
  {
    id: 82,
    name: "Royal gold watch",
    price: 145.0,
    originalPrice: 150.0,
    category: "watch",
    image: "./images/products/rgw.jpg",
    hoverImage: "./images/products/rgw.jpg",
  },
  {
    id: 83,
    name: "Hand Fan",
    price: 45.0,
    originalPrice: 50.0,
    category: "electronic",
    image: "./images/products/fan.jpg",
    hoverImage: "./images/products/fan.jpg",
  },
  {
    id: 84,
    name: "Makeup set",
    price: 95.0,
    originalPrice: 98.0,
    category: "cosmetic",
    image: "./images/products/ms.jpg",
    hoverImage: "./images/products/ms.jpg",
  },
  {
    id: 85,
    name: "Comfort glasses",
    price: 45.0,
    originalPrice: 50.0,
    category: "glasses",
    image: "./images/products/glass.jpg",
    hoverImage: "./images/products/glass.jpg",
  },
  {
    id: 86,
    name: "Microwave",
    price: 199.99,
    originalPrice: 200.99,
    category: "appliance",
    image: "./images/products/mwave.jpg",
    hoverImage: "./images/products/mwave.jpg",
  },
  {
    id: 87,
    name: "Gaming Chair",
    price: 145.0,
    originalPrice: 150.0,
    category: "appliance",
    image: "./images/products/chair.jpg",
    hoverImage: "./images/products/chair.jpg",
  },
  {
    id: 88,
    name: "Baby Potty",
    price: 65.0,
    originalPrice: 70.0,
    category: "baby",
    image: "./images/products/potty.jpg",
    hoverImage: "./images/products/potty.jpg",
  },
  {
    id: 89,
    name: "Unisex Glasses",
    price: 45.0,
    originalPrice: 50.0,
    category: "glasses",
    image: "./images/products/glass1.jpg",
    hoverImage: "./images/products/glass1.jpg",
  },
  {
    id: 90,
    name: "Silver Watch",
    price: 189.0,
    originalPrice: 199.0,
    category: "watch",
    image: "./images/products/swatch.jpg",
    hoverImage: "./images/products/swatch.jpg",
  },
  {
    id: 91,
    name: "Geometric frame",
    price: 45.0,
    originalPrice: 50.0,
    category: "glasses",
    image: "./images/products/glass2.jpg",
    hoverImage: "./images/products/glass2.jpg",
  },
  {
    id: 92,
    name: "Ladies Bag",
    price: 45.0,
    originalPrice: 50.0,
    category: "bag",
    image: "./images/products/scbag2.jpg",
    hoverImage: "./images/products/scbag2.jpg",
  },
  {
    id: 93,
    name: "Casual Frame",
    price: 45.0,
    originalPrice: 50.0,
    category: "glasses",
    image: "./images/products/glass3.jpg",
    hoverImage: "./images/products/glass3.jpg",
  },
  {
    id: 94,
    name: "Butterfly Bracelet",
    price: 45.0,
    originalPrice: 50.0,
    category: "accessories",
    image: "./images/products/blet.jpg",
    hoverImage: "./images/products/blet.jpg",
  },
  {
    id: 95,
    name: "Gaming Headset",
    price: 95.0,
    originalPrice: 100.0,
    category: "electronic",
    image: "./images/products/gset.jpg",
    hoverImage: "./images/products/gset.jpg",
  },
  {
    id: 96,
    name: "Gaming Chair",
    price: 199.0,
    originalPrice: 200.0,
    category: "appliance",
    image: "./images/products/chair2.jpg",
    hoverImage: "./images/products/chair2.jpg",
  },
  {
    id: 97,
    name: "Diamond Ring",
    price: 299.0,
    originalPrice: 300.0,
    category: "accessories",
    image: "./images/products/dring.jpg",
    hoverImage: "./images/products/dring.jpg",
  },
  {
    id: 98,
    name: "Ladies Purse",
    price: 65.0,
    originalPrice: 70.0,
    category: "bag",
    image: "./images/products/rbag.jpg",
    hoverImage: "./images/products/rbag.jpg",
  },
  {
    id: 99,
    name: "FlashDrive",
    price: 45.0,
    originalPrice: 50.0,
    category: "electronic",
    image: "./images/products/fdrive.jpg",
    hoverImage: "./images/products/fdrive.jpg",
  },
  {
    id: 100,
    name: "2pcs Messenger bag",
    price: 99.0,
    originalPrice: 109.0,
    category: "bag",
    image: "./images/products/2pcs.jpg",
    hoverImage: "./images/products/2pcs.jpg",
  },
  {
    id: 101,
    name: "Black Watch",
    price: 69.0,
    originalPrice: 79.0,
    category: "watch",
    image: "./images/products/bwatch.jpg",
    hoverImage: "./images/products/bwatch.jpg",
  },
  {
    id: 102,
    name: "Black Cap",
    price: 45.0,
    originalPrice: 50.0,
    category: "hats",
    image: "./images/products/cap.jpg",
    hoverImage: "./images/products/cap.jpg",
  },
  {
    id: 103,
    name: "Shampoo-conditioner",
    price: 145.0,
    originalPrice: 150.0,
    category: "hair",
    image: "./images/products/hair.jpg",
    hoverImage: "./images/products/hair.jpg",
  },
  {
    id: 104,
    name: "Sauvage Dior Perfume",
    price: 55.0,
    originalPrice: 65.0,
    category: "perfume",
    image: "./images/products/pef2.jpg",
    hoverImage: "./images/products/pef2.jpg",
  },
];

// State variables for the shopping experience
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
let orderHistory = JSON.parse(localStorage.getItem("orderHistory")) || [];
let isOrderSubmitted = false;
const CHECKOUT_FEE = 15;

// DOM elements
const productGrid = document.getElementById("product-grid");
const favoritesSection = document.getElementById("favorites-section");
const favoritesList = document.getElementById("favorites-list");
const cartSection = document.getElementById("cart-section");
const cartList = document.getElementById("cart-list");
const cartTotalElement = document.getElementById("cart-total");
const cartCount = document.getElementById("cart-count");
const mobileCartCount = document.getElementById("mobile-cart-count");
const favoritesCount = document.getElementById("favorites-count");
const mobileFavoritesCount = document.getElementById("mobile-favorites-count");
const searchInput = document.getElementById("search-input");
const categoriesContainer = document.getElementById("categories-container");
const checkoutSection = document.getElementById("checkout-section");
const checkoutForm = document.getElementById("checkout-form");
const bankDetails = document.getElementById("bank-details");
const orderHistorySection = document.getElementById("orders-section");
const orderHistoryList = document.getElementById("order-history-list");
const productDetailsModal = document.getElementById("product-details-modal");
const modalProductImage = document.getElementById("modal-product-image");
const modalProductTitle = document.getElementById("modal-product-title");
const modalProductDescription = document.getElementById(
  "modal-product-description"
);
const mainContainer = document.querySelector("main .container");

function showMessage(message, type = "success") {
  const modal = document.createElement("div");
  modal.className = `message-modal ${type}`;
  modal.innerHTML = `
      <div class="message-content">
          <p>${message}</p>
          <button onclick="this.parentNode.parentNode.remove()">OK</button>
      </div>
  `;
  document.body.appendChild(modal);
}

// Function to save state to localStorage
function saveState() {
  localStorage.setItem("cart", JSON.stringify(cart));
  localStorage.setItem("favorites", JSON.stringify(favorites));
  localStorage.setItem("orderHistory", JSON.stringify(orderHistory));
}

// Function to update the cart and favorites count
function updateCounts() {
  cartCount.textContent = cart.length;
  mobileCartCount.textContent = cart.length;
  favoritesCount.textContent = favorites.length;
  mobileFavoritesCount.textContent = favorites.length;
}

// Function to calculate the cart total
const originalUpdateCartTotal = updateCartTotal;
function updateCartTotal() {
  const subtotal = cart.reduce(
    (total, item) => total + item.price * item.quantity,
    0
  );
  const finalTotal = subtotal > 0 ? subtotal + CHECKOUT_FEE : 0;
  cartTotalElement.innerHTML = `
      <p>Subtotal: <span>$${subtotal.toFixed(2)}</span></p>
      <p>Checkout Fee: <span>$${CHECKOUT_FEE.toFixed(2)}</span></p>
      <p><strong>Total: <span>$${finalTotal.toFixed(2)}</span></strong></p>
  `;
}

// Function to render a single product card
const originalRenderProductCard = renderProductCard;
function renderProductCard(product) {
  const isFavorite = favorites.some((fav) => fav.id === product.id);
  const translatedProduct = getTranslatedProduct(product);
  const productCard = document.createElement("div");
  productCard.className = "showcase";
  productCard.innerHTML = `
      <div class="showcase-banner">
          <img src="${product.image}" alt="${
    translatedProduct.translatedName
  }" width="300" class="product-img default" onerror="this.onerror=null; this.src='https://placehold.co/300x300?text=Product+Image';">
          <img src="${product.hoverImage}" alt="${
    translatedProduct.translatedName
  } Hover" width="300" class="product-img hover" onerror="this.onerror=null; this.src='https://placehold.co/300x300?text=Hover+Image';">
          <p class="showcase-badge angle bg-pink">${(
            ((product.originalPrice - product.price) / product.originalPrice) *
            100
          ).toFixed(0)}% OFF</p>
          <div class="showcase-actions">
              <button class="action-btn favorite-btn ${
                isFavorite ? "active" : ""
              }" data-product-id="${product.id}">
                  <ion-icon name="heart"></ion-icon>
              </button>
              <button class="action-btn cart-btn" data-product-id="${
                product.id
              }">
                  <ion-icon name="bag-add"></ion-icon>
              </button>
          </div>
      </div>
      <div class="showcase-content">
          <a href="#" class="showcase-category">${translate(
            product.category.toLowerCase()
          )}</a>
          <a href="#">
              <h3 class="showcase-title">${
                translatedProduct.translatedName
              }</h3>
          </a>
          <div class="price-box">
              <p class="price">${product.price.toFixed(2)}</p>
              <del>${product.originalPrice.toFixed(2)}</del>
          </div>
      </div>
  `;

  // Add event listeners for product image click, favorite, and cart buttons
  productCard
    .querySelector(".product-img.default")
    .addEventListener("click", () => showProductDetails(product));
  productCard
    .querySelector(".favorite-btn")
    .addEventListener("click", () => toggleFavorite(product));
  productCard
    .querySelector(".cart-btn")
    .addEventListener("click", () => addToCart(product));

  return productCard;
}

// Function to render all products
const originalRenderProducts = renderProducts;
function renderProducts(filteredProducts = products) {
  productGrid.innerHTML = "";
  if (filteredProducts.length === 0) {
    productGrid.innerHTML = `<p class="no-results">${translate(
      "no-results"
    )}</p>`;
  } else {
    filteredProducts.forEach((product) => {
      productGrid.appendChild(renderProductCard(product));
    });
  }
}

// Function to render categories
const originalRenderCategories = renderCategories;
function renderCategories() {
  const uniqueCategories = ["All", ...new Set(products.map((p) => p.category))];
  categoriesContainer.innerHTML = "";
  uniqueCategories.forEach((category) => {
    const categoryBtn = document.createElement("button");
    categoryBtn.className = "category-btn";
    // Translate category names
    const translatedCategory = translate(category.toLowerCase()) || category;
    categoryBtn.textContent = translatedCategory;
    categoryBtn.setAttribute("data-category", category); // Store original category for filtering
    categoryBtn.addEventListener("click", () =>
      filterProductsByCategory(category)
    );
    categoriesContainer.appendChild(categoryBtn);
  });
  updateCategoryButtons("All");
}

// Function to update active category button
function updateCategoryButtons(activeCategory) {
  document.querySelectorAll(".category-btn").forEach((btn) => {
    if (btn.textContent.toLowerCase() === activeCategory.toLowerCase()) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
}

// Function to filter products by category
function filterProductsByCategory(category) {
  updateCategoryButtons(category);
  if (category === "All") {
    renderProducts();
  } else {
    const filtered = products.filter(
      (p) => p.category.toLowerCase() === category.toLowerCase()
    );
    renderProducts(filtered);
  }
}

// Function to toggle a product in favorites
const originalToggleFavorite = toggleFavorite;
function toggleFavorite(product) {
  const index = favorites.findIndex((fav) => fav.id === product.id);
  if (index === -1) {
    favorites.push(product);
    showMessage(`${product.name} ${translate("added-to-favorites")}`);
  } else {
    favorites.splice(index, 1);
    showMessage(
      `${product.name} ${translate("removed-from-favorites")}`,
      "info"
    );
  }
  saveState();
  updateCounts();
  renderProducts();
  if (favoritesSection.style.display === "block") {
    renderFavorites();
  }
}

// Function to remove an item from favorites manually
const originalRemoveFavorite = removeFavorite;
function removeFavorite(productId) {
  favorites = favorites.filter((fav) => fav.id !== productId);
  saveState();
  updateCounts();
  renderFavorites();
  renderProducts();
  showMessage(translate("removed-from-favorites-msg"));
}

// Function to add a product to the cart
const originalAddToCart = addToCart;
function addToCart(product) {
  const existingItem = cart.find((item) => item.id === product.id);
  if (existingItem) {
    existingItem.quantity += 1;
    showMessage(
      `${product.name} ${translate("quantity-increased")} ${
        existingItem.quantity
      }`
    );
  } else {
    cart.push({ ...product, quantity: 1 });
    showMessage(`${product.name} ${translate("added-to-cart")}`);
  }
  saveState();
  updateCounts();
  if (cartSection.style.display === "block") {
    renderCart();
  }
}

// Function to remove a product from the cart
const originalRemoveFromCart = removeFromCart;
function removeFromCart(productId) {
  cart = cart.filter((item) => item.id !== productId);
  saveState();
  updateCounts();
  renderCart();
  showMessage(translate("removed-from-cart"));
}

// Function to change item quantity in cart
function changeQuantity(productId, change) {
  const item = cart.find((item) => item.id === productId);
  if (item) {
    item.quantity += change;
    if (item.quantity <= 0) {
      removeFromCart(productId);
    } else {
      saveState();
      renderCart();
    }
  }
}

// Function to show the full image and description
function showProductDetails(product) {
  modalProductImage.src = product.image;
  modalProductTitle.textContent = product.name;
  modalProductDescription.textContent = product.description;
  productDetailsModal.style.display = "flex";
}

// Function to close the product details modal
function closeProductDetailsModal() {
  productDetailsModal.style.display = "none";
}

// Function to render the favorites section
const originalRenderFavorites = renderFavorites;
function renderFavorites() {
  favoritesList.innerHTML = "";
  if (favorites.length === 0) {
    favoritesList.innerHTML = `<p>${translate("favorites-empty")}</p>`;
  } else {
    favorites.forEach((product) => {
      const translatedProduct = getTranslatedProduct(product);
      const favoriteItem = document.createElement("div");
      favoriteItem.className = "favorite-item";
      favoriteItem.innerHTML = `
              <img src="${product.image}" alt="${
        translatedProduct.translatedName
      }" class="favorite-item-image">
              <div class="favorite-item-info">
                  <h4 class="favorite-item-name">${
                    translatedProduct.translatedName
                  }</h4>
                  <p class="favorite-item-price">${product.price.toFixed(2)}</p>
              </div>
              <button class="remove-btn" onclick="removeFavorite(${
                product.id
              })">
                  <ion-icon name="trash-outline"></ion-icon>
              </button>
          `;
      favoritesList.appendChild(favoriteItem);
    });
  }
}

// Function to render the cart section
const originalRenderCart = renderCart;
function renderCart() {
  cartList.innerHTML = "";
  if (cart.length === 0) {
    cartList.innerHTML = "<p>Your cart is empty.</p>";
    cartTotalElement.style.display = "none";
  } else {
    cart.forEach((item) => {
      const cartItem = document.createElement("div");
      cartItem.className = "cart-item";
      cartItem.innerHTML = `
              <img src="${item.image}" alt="${
        item.name
      }" class="cart-item-image">
              <div class="cart-item-info">
                  <h4 class="cart-item-name">${item.name}</h4>
                  <p class="cart-item-price">$${(
                    item.price * item.quantity
                  ).toFixed(2)}</p>
              </div>
              <div class="cart-item-controls">
                  <button class="quantity-btn" onclick="changeQuantity(${
                    item.id
                  }, -1)">-</button>
                  <span>${item.quantity}</span>
                  <button class="quantity-btn" onclick="changeQuantity(${
                    item.id
                  }, 1)">+</button>
              </div>
              <button class="remove-btn" onclick="removeFromCart(${item.id})">
                  <ion-icon name="trash-outline"></ion-icon>
              </button>
          `;
      cartList.appendChild(cartItem);
    });
    cartTotalElement.style.display = "block";
  }
  updateCartTotal();
}

// Function to render the order history
const originalRenderOrderHistory = renderOrderHistory;
function renderOrderHistory() {
  orderHistoryList.innerHTML = "";

  if (orderHistory.length === 0) {
    orderHistoryList.innerHTML = "<p>You have no past orders.</p>";
  } else {
    orderHistory.forEach((order) => {
      const orderItem = document.createElement("div");
      orderItem.className = "order-item";
      orderItem.innerHTML = `
              <h4 class="order-date">Order Placed: ${new Date(
                order.date
              ).toLocaleString()}</h4>
              <p><strong>Total Price: $${order.totalPrice.toFixed(
                2
              )}</strong></p>
              <div class="order-details">
                  <p><strong>Customer:</strong> ${order.name}</p>
                  <p><strong>Email:</strong> ${order.email}</p>
                  <p><strong>Address:</strong> ${order.address}</p>
                  <p><strong>Phone:</strong> ${order.phone}</p>
              </div>
              <h5>Products:</h5>
              <ul class="order-products-list">
                  ${order.products
                    .map(
                      (p) =>
                        `<li>${p.name} (x${p.quantity}) - $${(
                          p.price * p.quantity
                        ).toFixed(2)}</li>`
                    )
                    .join("")}
              </ul>
          `;
      orderHistoryList.appendChild(orderItem);
    });
  }
}

// Function to clear order history
const originalClearOrderHistory = clearOrderHistory;
function clearOrderHistory() {
  orderHistory = [];
  saveState();
  renderOrderHistory();
  showMessage("Order history has been cleared.");
}

// Function to toggle between different sections
function showSection(sectionId) {
  const sections = [
    productGrid.parentNode,
    favoritesSection,
    cartSection,
    checkoutSection,
    orderHistorySection,
  ];
  sections.forEach((section) => {
    section.style.display = "none";
  });
  document.getElementById(sectionId).style.display = "block";
}

function showProducts() {
  showSection("products-container");
  renderProducts();
}

function showFavorites() {
  showSection("favorites-section");
  renderFavorites();
}

function showCart() {
  showSection("cart-section");
  renderCart();
}

const originalShowCheckout = showCheckout;
function showCheckout() {
  if (cart.length === 0) {
    showMessage("Your cart is empty. Add products to checkout.", "error");
    return;
  }
  showSection("checkout-section");
  toggleBankDetails();
}

function showOrderHistory() {
  showSection("orders-section");
  renderOrderHistory();
}

// Function to handle search input
function handleSearch(event) {
  const searchTerm = event.target.value.toLowerCase();
  const filteredProducts = products.filter(
    (p) =>
      p.name.toLowerCase().includes(searchTerm) ||
      p.category.toLowerCase().includes(searchTerm)
  );
  renderProducts(filteredProducts);
}

// Function to toggle bank details based on payment method
function toggleBankDetails() {
  const paymentMethod = document.getElementById("payment-method").value;
  bankDetails.style.display = paymentMethod === "bank" ? "block" : "none";
}

// Handle checkout form submission
const originalCheckoutFormHandler = checkoutForm.onsubmit;
checkoutForm.addEventListener("submit", (e) => {
  e.preventDefault();
  if (!cart.length) {
    showMessage("Cannot submit an empty order.", "error");
    return;
  }

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const address = document.getElementById("address").value;
  const phone = document.getElementById("phone").value;
  const subtotal = cart.reduce(
    (total, item) => total + item.price * item.quantity,
    0
  );
  const finalTotal = subtotal + CHECKOUT_FEE;

  const newOrder = {
    name,
    email,
    address,
    phone,
    products: cart.map((item) => ({
      id: item.id,
      name: item.name,
      quantity: item.quantity,
      price: item.price,
    })),
    totalPrice: finalTotal,
    date: new Date().toISOString(),
  };

  orderHistory.push(newOrder);
  cart = [];
  saveState();
  updateCounts();
  showMessage("Order completed! Thanks for shopping with us.");
  setTimeout(() => {
    showOrderHistory();
    window.location.reload();
  }, 2000);
});

// Event listeners for search and initial page load
searchInput.addEventListener("input", handleSearch);
window.addEventListener("load", () => {
  updateCounts();
  renderCategories();
  // Check for category in URL params for deep linking
  const urlParams = new URLSearchParams(window.location.search);
  const categoryFromUrl = urlParams.get("category");
  if (categoryFromUrl) {
    filterProductsByCategory(categoryFromUrl);
  } else {
    renderProducts();
  }
});

// Function to update categories when language changes
function updateCategoriesLanguage() {
  if (categoriesContainer) {
    renderCategories();
  }
}

// Listen for language changes
document.addEventListener("DOMContentLoaded", function () {
  // Override the original window load event to include language updates
  const originalWindowLoad = window.onload;
  window.addEventListener("load", () => {
    updateCounts();
    renderCategories();
    const urlParams = new URLSearchParams(window.location.search);
    const categoryFromUrl = urlParams.get("category");
    if (categoryFromUrl) {
      filterProductsByCategory(categoryFromUrl);
    } else {
      renderProducts();
    }
  });
});

// Add language update to existing functions
const originalChangeLanguage = window.changeLanguage;
window.changeLanguage = function (language) {
  currentLanguage = language;
  localStorage.setItem("selectedLanguage", language);
  updatePageLanguage();
  updateCategoriesLanguage();

  // Re-render current section with new language
  if (favoritesSection.style.display === "block") {
    renderFavorites();
  } else if (cartSection.style.display === "block") {
    renderCart();
  } else if (orderHistorySection.style.display === "block") {
    renderOrderHistory();
  } else {
    renderProducts();
  }

  // Update language selector
  const languageSelect = document.querySelector('select[name="language"]');
  if (languageSelect) {
    languageSelect.value = language === "en" ? "en-US" : "fr";
  }
};

// Modal for product details
const productDetailsModalHtml = `
  <div id="product-details-modal" class="product-details-modal">
      <div class="modal-content">
          <span class="close-btn" onclick="closeProductDetailsModal()">&times;</span>
          <div class="modal-body">
              <img id="modal-product-image" src="" alt="Product" class="modal-image">
              <div class="modal-details">
                  <h3 id="modal-product-title"></h3>
                  <p id="modal-product-description"></p>
              </div>
          </div>
      </div>
  </div>
  <style>
      .product-details-modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgba(0,0,0,0.7);
          align-items: center;
          justify-content: center;
          backdrop-filter: blur(5px);
      }
      .modal-content {
          background-color: var(--white);
          padding: 20px;
          border-radius: var(--border-radius-md);
          box-shadow: 0 5px 20px hsla(0, 0%, 0%, 0.25);
          max-width: 90%;
          width: 800px;
          position: relative;
          display: flex;
          flex-direction: column;
      }
      .close-btn {
          color: var(--davys-gray);
          font-size: 28px;
          font-weight: bold;
          position: absolute;
          top: 10px;
          right: 15px;
          cursor: pointer;
      }
      .modal-body {
          display: flex;
          flex-direction: column;
          gap: 20px;
      }
      .modal-image {
          width: 100%;
          height: auto;
          object-fit: contain;
          border-radius: var(--border-radius-sm);
      }
      .modal-details {
          text-align: center;
      }
      .modal-details h3 {
          font-size: var(--fs-4);
          font-weight: var(--weight-600);
          color: var(--eerie-black);
          margin-bottom: 10px;
      }
      .modal-details p {
          font-size: var(--fs-6);
          color: var(--davys-gray);
      }
      .message-modal {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          z-index: 1001;
          background-color: var(--white);
          padding: 20px;
          border-radius: var(--border-radius-md);
          box-shadow: 0 5px 20px hsla(0, 0%, 0%, 0.25);
          text-align: center;
          animation: fadeIn 0.3s ease-out;
      }
      .message-modal.success { border: 2px solid var(--salmon-pink); }
      .message-modal.error { border: 2px solid var(--bittersweet); }
      .message-modal.info { border: 2px solid var(--davys-gray); }
      @keyframes fadeIn {
          from { opacity: 0; transform: translate(-50%, -60%); }
          to { opacity: 1; transform: translate(-50%, -50%); }
      }
      .message-content button {
          margin-top: 15px;
          padding: 8px 20px;
          background-color: var(--salmon-pink);
          color: var(--white);
          border: none;
          border-radius: var(--border-radius-sm);
          cursor: pointer;
      }
      .cart-item-controls {
          display: flex;
          align-items: center;
          gap: 8px;
          margin-left: auto;
      }
      .cart-item-controls span {
          font-size: var(--fs-5);
          font-weight: var(--weight-600);
      }
      .quantity-btn {
          background-color: var(--cultured);
          border: none;
          padding: 5px 10px;
          border-radius: 50%;
          font-weight: bold;
          cursor: pointer;
      }
      .remove-btn {
          background: none;
          border: none;
          color: var(--bittersweet);
          font-size: 20px;
          cursor: pointer;
      }
      .order-item {
          border: 1px solid var(--cultured);
          padding: 15px;
          border-radius: var(--border-radius-md);
          margin-bottom: 15px;
      }
      .order-item h4 {
          margin-bottom: 10px;
          color: var(--eerie-black);
      }
      .order-products-list {
          list-style-type: disc;
          margin-left: 20px;
      }
      /* New CSS for image hover effect */
      .showcase-banner {
          position: relative;
      }
      .showcase-banner .product-img.hover {
          position: absolute;
          top: 0;
          left: 0;
          opacity: 0;
          transition: opacity 0.5s ease;
      }
      .showcase:hover .product-img.default {
          opacity: 0;
      }
      .showcase:hover .product-img.hover {
          opacity: 1;
      }
      /* Mobile-first adjustments for the modal */
      @media (min-width: 768px) {
          .modal-body {
              flex-direction: row;
          }
          .modal-image {
              max-width: 50%;
          }
          .modal-details {
              text-align: left;
          }
      }
  </style>
`;
mainContainer.insertAdjacentHTML("beforeend", productDetailsModalHtml);
